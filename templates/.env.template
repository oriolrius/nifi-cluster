# =============================================================================
# Multi-Cluster NiFi Configuration Template
# =============================================================================
# This template is used by the cluster generation scripts to create isolated
# NiFi clusters. Each cluster gets its own configuration, ports, and volumes.
#
# USAGE: Copy this file to clusters/<cluster-name>/.env and customize values

# =============================================================================
# CLUSTER IDENTITY
# =============================================================================
# Unique identifier for this cluster (e.g., cluster01, cluster02, prod, dev)
CLUSTER_NAME=cluster01

# Numeric identifier used for port calculations (1-99 recommended)
# Port formula: BASE_PORT + (CLUSTER_NUM * 1000) + service_offset
CLUSTER_NUM=1

# Number of NiFi nodes in the cluster (typically 3 for HA)
NODE_COUNT=3

# =============================================================================
# VERSION SETTINGS
# =============================================================================
# Docker image versions - use specific versions for production stability
NIFI_VERSION=latest
ZOOKEEPER_VERSION=3.9

# =============================================================================
# PORT ASSIGNMENTS
# =============================================================================
# Port Calculation Formula:
# - Base Port: 29000 (configurable)
# - Cluster Offset: CLUSTER_NUM * 1000
# - Service Offset: Varies by service and node
#
# Examples for CLUSTER_NUM=1 (cluster01):
#   ZK_PORT_1 = 29000 + (1 * 1000) + 181 = 30181
#   HTTPS_PORT_1 = 29000 + (1 * 1000) + 443 = 30443

# Base port for all services (default: 29000)
BASE_PORT=29000

# ZooKeeper Client Ports (external access)
# Formula: BASE_PORT + (CLUSTER_NUM * 1000) + 181/182/183
ZK_PORT_1=30181
ZK_PORT_2=30182
ZK_PORT_3=30183

# NiFi HTTPS Web UI Ports
# Formula: BASE_PORT + (CLUSTER_NUM * 1000) + 443/444/445
HTTPS_PORT_1=30443
HTTPS_PORT_2=30444
HTTPS_PORT_3=30445

# NiFi Site-to-Site (S2S) Ports
# Formula: BASE_PORT + (CLUSTER_NUM * 1000) + 100/101/102
S2S_PORT_1=30100
S2S_PORT_2=30101
S2S_PORT_3=30102

# =============================================================================
# SERVICE NAMES
# =============================================================================
# Container and hostname prefixes (derived from CLUSTER_NAME)
# Format: ${CLUSTER_NAME}-<service>-<node>

# ZooKeeper service names
ZK_NODE_1=${CLUSTER_NAME}-zookeeper-1
ZK_NODE_2=${CLUSTER_NAME}-zookeeper-2
ZK_NODE_3=${CLUSTER_NAME}-zookeeper-3

# NiFi service names
NIFI_NODE_1=${CLUSTER_NAME}-nifi-1
NIFI_NODE_2=${CLUSTER_NAME}-nifi-2
NIFI_NODE_3=${CLUSTER_NAME}-nifi-3

# =============================================================================
# DERIVED CONFIGURATION VALUES
# =============================================================================
# These values are automatically constructed from the above settings

# ZooKeeper Connection String
# Format: host1:port,host2:port,host3:port
ZK_CONNECT_STRING=${ZK_NODE_1}:2181,${ZK_NODE_2}:2181,${ZK_NODE_3}:2181

# ZooKeeper Root Node (cluster namespace in ZooKeeper)
# Used in state-management.xml to isolate cluster state
ZK_ROOT_NODE=/${CLUSTER_NAME}

# NiFi Web Proxy Hosts (comma-separated list of allowed proxy hosts)
# Includes both localhost ports and internal cluster hostnames
WEB_PROXY_HOST=localhost:${HTTPS_PORT_1},localhost:${HTTPS_PORT_2},localhost:${HTTPS_PORT_3},${NIFI_NODE_1}:8443,${NIFI_NODE_2}:8443,${NIFI_NODE_3}:8443

# Docker Network Name (isolated per cluster)
NETWORK_NAME=${CLUSTER_NAME}-network

# =============================================================================
# PATHS
# =============================================================================
# Base directory for this cluster (relative to project root)
CLUSTER_BASE_PATH=./clusters/${CLUSTER_NAME}

# Configuration files directory
CONF_BASE_PATH=${CLUSTER_BASE_PATH}/conf

# Persistent data volumes directory
VOLUME_BASE_PATH=${CLUSTER_BASE_PATH}/volumes

# Certificates directory (for PKI/TLS)
CERTS_BASE_PATH=${CLUSTER_BASE_PATH}/certs

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# NiFi Single User Authentication (for development/demo environments)
# IMPORTANT: Change these values before deploying to production!
NIFI_SINGLE_USER_USERNAME=admin
NIFI_SINGLE_USER_PASSWORD=changeme123456

# Sensitive Properties Key (for encrypting sensitive values in NiFi)
# Must be at least 12 characters. Generate a strong random key for production.
# Example: openssl rand -base64 24
NIFI_SENSITIVE_PROPS_KEY=changeme_sensitive_key_123

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
# JVM Heap Settings (adjust based on available system resources)
# Recommendation:
#   - Development: 2g-4g
#   - Production: 8g-16g (or more depending on workload)
#   - Set INIT and MAX to the same value to avoid heap resizing overhead
NIFI_JVM_HEAP_INIT=2g
NIFI_JVM_HEAP_MAX=2g

# =============================================================================
# ZOOKEEPER SETTINGS
# =============================================================================
# ZooKeeper ensemble configuration (internal settings)
ZOO_TICK_TIME=2000
ZOO_INIT_LIMIT=10
ZOO_SYNC_LIMIT=5
ZOO_MAX_CLIENT_CNXNS=60

# =============================================================================
# CLUSTER COORDINATION
# =============================================================================
# NiFi cluster protocol settings
NIFI_CLUSTER_NODE_PROTOCOL_PORT=8082
NIFI_ELECTION_MAX_WAIT=1 min

# =============================================================================
# NOTES
# =============================================================================
# Port Allocation Strategy:
# - Each cluster uses a 1000-port range
# - Cluster 1 (cluster01): 30000-30999
# - Cluster 2 (cluster02): 31000-31999
# - Cluster 3 (cluster03): 32000-32999
# - etc.
#
# This ensures no port conflicts between clusters running on the same host.
#
# Security Recommendations:
# 1. Generate strong random passwords for production
# 2. Use specific version tags instead of 'latest' for stability
# 3. Enable proper authentication and authorization
# 4. Use TLS/SSL certificates from a trusted CA for production
# 5. Regularly update sensitive property keys and rotate credentials
#
# Performance Recommendations:
# 1. Allocate heap based on workload (monitor with JConsole/VisualVM)
# 2. Use SSDs for content_repository and flowfile_repository
# 3. Separate provenance_repository onto different disk for I/O isolation
# 4. Monitor and tune based on actual usage patterns
