# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.

# NiFi Cluster Configuration Template
# This template uses parameterized markers: @@MARKER@@
#
# Required substitutions:
# - @@NODE_NAME@@           : Node-specific hostname (e.g., nifi-1, nifi-2, nifi-3)
# - @@CLUSTER_NAME@@        : Cluster identifier (e.g., cluster01, cluster02)
# - @@ZK_CONNECT_STRING@@   : ZooKeeper connection string (e.g., zookeeper-1:2181,zookeeper-2:2181,zookeeper-3:2181)
# - @@WEB_PROXY_HOSTS@@     : Comma-separated proxy hosts (e.g., localhost:59443,localhost:59444,localhost:59445)
# - @@SENSITIVE_PROPS_KEY@@ : Encryption key for sensitive properties (must be same across cluster)

####################
# Core Properties #
####################
nifi.flow.configuration.file=./conf/flow.json.gz
nifi.flow.configuration.archive.enabled=true
nifi.flow.configuration.archive.dir=./conf/archive/
nifi.flow.configuration.archive.max.time=30 days
nifi.flow.configuration.archive.max.storage=500 MB
nifi.flowcontroller.autoResumeState=true
nifi.flowcontroller.graceful.shutdown.period=10 sec
nifi.flowservice.writedelay.interval=500 ms
nifi.administrative.yield.duration=30 sec
nifi.bored.yield.duration=10 millis
nifi.queue.backpressure.count=10000
nifi.queue.backpressure.size=1 GB

nifi.authorizer.configuration.file=./conf/authorizers.xml
nifi.login.identity.provider.configuration.file=./conf/login-identity-providers.xml
nifi.nar.library.directory=./lib
nifi.nar.library.autoload.directory=/opt/nifi/nifi-current/nar_extensions
nifi.nar.working.directory=./work/nar/

####################
# State Management #
####################
nifi.state.management.configuration.file=./conf/state-management.xml
nifi.state.management.provider.local=local-provider
nifi.state.management.provider.cluster=zk-provider
nifi.state.management.embedded.zookeeper.start=false

# Database Settings
nifi.database.directory=./database_repository

# FlowFile Repository
nifi.flowfile.repository.implementation=org.apache.nifi.controller.repository.WriteAheadFlowFileRepository
nifi.flowfile.repository.directory=./flowfile_repository
nifi.flowfile.repository.checkpoint.interval=20 secs
nifi.flowfile.repository.always.sync=false

nifi.swap.manager.implementation=org.apache.nifi.controller.FileSystemSwapManager
nifi.queue.swap.threshold=20000

# Content Repository
nifi.content.repository.implementation=org.apache.nifi.controller.repository.FileSystemRepository
nifi.content.claim.max.appendable.size=50 KB
nifi.content.repository.directory.default=./content_repository
nifi.content.repository.archive.max.retention.period=3 hours
nifi.content.repository.archive.max.usage.percentage=90%
nifi.content.repository.archive.enabled=true
nifi.content.repository.always.sync=false

# Provenance Repository
nifi.provenance.repository.implementation=org.apache.nifi.provenance.WriteAheadProvenanceRepository
nifi.provenance.repository.directory.default=./provenance_repository
nifi.provenance.repository.max.storage.time=30 days
nifi.provenance.repository.max.storage.size=10 GB
nifi.provenance.repository.rollover.time=10 mins
nifi.provenance.repository.rollover.size=100 MB

# Status History Repository
nifi.components.status.repository.implementation=org.apache.nifi.controller.status.history.VolatileComponentStatusRepository
nifi.components.status.repository.buffer.size=1440
nifi.components.status.snapshot.frequency=1 min

#####################
# Site-to-Site      #
#####################
nifi.remote.input.host=@@NODE_NAME@@
nifi.remote.input.secure=true
nifi.remote.input.socket.port=10000
nifi.remote.input.http.enabled=true
nifi.remote.input.http.transaction.ttl=30 sec

#####################
# Web Properties    #
#####################
# HTTP disabled for security
nifi.web.http.host=
nifi.web.http.port=

# HTTPS enabled
nifi.web.https.host=@@NODE_NAME@@
nifi.web.https.port=8443
nifi.web.https.network.interface.default=
nifi.web.https.application.protocols=h2 http/1.1
nifi.web.jetty.working.directory=./work/jetty
nifi.web.jetty.threads=200
nifi.web.max.header.size=16 KB

# Proxy configuration for cluster access
nifi.web.proxy.host=@@WEB_PROXY_HOSTS@@
nifi.web.max.requests.per.second=30000
nifi.web.request.timeout=60 secs

#####################
# Security Properties
#####################
nifi.sensitive.props.key=@@SENSITIVE_PROPS_KEY@@
nifi.sensitive.props.algorithm=NIFI_PBKDF2_AES_GCM_256

# SSL/TLS Configuration - Using your existing certificates
nifi.security.keystore=./conf/keystore.p12
nifi.security.keystoreType=PKCS12
nifi.security.keystorePasswd=changeme123456
nifi.security.keyPasswd=changeme123456
nifi.security.truststore=./conf/truststore.p12
nifi.security.truststoreType=PKCS12
nifi.security.truststorePasswd=changeme123456

# Single User Authentication (for demo/dev)
nifi.security.user.authorizer=single-user-authorizer
nifi.security.allow.anonymous.authentication=false
nifi.security.user.login.identity.provider=single-user-provider
nifi.security.user.jws.key.rotation.period=PT1H

#####################
# Cluster Properties
#####################
# Cluster Common Properties (same for all nodes)
nifi.cluster.protocol.heartbeat.interval=5 sec
nifi.cluster.protocol.heartbeat.missable.max=8
nifi.cluster.protocol.is.secure=true

# Cluster Node Properties (node-specific)
nifi.cluster.is.node=true
nifi.cluster.leader.election.implementation=CuratorLeaderElectionManager
nifi.cluster.node.address=@@NODE_NAME@@
nifi.cluster.node.protocol.port=8082
nifi.cluster.node.protocol.max.threads=50
nifi.cluster.node.event.history.size=25
nifi.cluster.node.connection.timeout=5 sec
nifi.cluster.node.read.timeout=5 sec
nifi.cluster.node.max.concurrent.requests=100
nifi.cluster.flow.election.max.wait.time=1 min

# Load Balancing
nifi.cluster.load.balance.host=
nifi.cluster.load.balance.port=6342
nifi.cluster.load.balance.connections.per.node=1
nifi.cluster.load.balance.max.thread.count=8
nifi.cluster.load.balance.comms.timeout=30 sec

#####################
# ZooKeeper         #
#####################
nifi.zookeeper.connect.string=@@ZK_CONNECT_STRING@@
nifi.zookeeper.connect.timeout=10 secs
nifi.zookeeper.session.timeout=10 secs
nifi.zookeeper.root.node=/@@CLUSTER_NAME@@
nifi.zookeeper.client.secure=false

#####################
# Performance Tuning
#####################
# JVM heap is set via environment variables in docker-compose.yml
# NIFI_JVM_HEAP_INIT and NIFI_JVM_HEAP_MAX

